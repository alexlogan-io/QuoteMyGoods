var eventHandler=function(t){alert(t)},JoinTheDots;!function(t){var e=function(){function t(t){this.helpers=new a,this.width=1e3,this.height=600,this.radius=15,this.padding=30;var e=this;this.dots=new n,this.svg=d3.select(t).append("div").selectAll("svg").data(d3.range(1).map(function(){return{x:e.width/2,y:e.height/2}})).enter().append("svg").attr("width",e.width).attr("height",e.height).on("mousedown",function(){e.mousedown(this,e)}).on("mousemove",function(){e.mousemove(this,e)}).on("contextmenu",function(t,e){d3.event.preventDefault()}),this.svg.selectAll("*").remove(),this.lineFunction=d3.svg.line().x(function(t){return t[0]}).y(function(t){return t[1]}).interpolate("linear"),this.drag=d3.behavior.drag().on("drag",function(){e.dragMove(this,e)}),this.xScale=d3.scale.linear().domain([-1e3,1e3]).range([this.padding,this.width-2*this.padding]),this.yScale=d3.scale.linear().domain([-1e3,1e3]).range([this.height-this.padding,this.padding]),this.xData=["One","Two","Three","Four","Five"],this.xAxis=d3.svg.axis().scale(this.xScale).orient("bottom").ticks(5).tickFormat(function(t,a){return e.xData[a]}),this.yData=["One","Two","","Four","Five"],this.yAxis=d3.svg.axis().scale(this.yScale).orient("left").ticks(5).tickFormat(function(t,a){return e.yData[a]}),this.createAxis(this.xAxis,this.yAxis,this.svg)}return t.prototype.createAxis=function(t,e,a){a.append("g").attr("id","x").attr("class","axis").attr("transform","translate("+this.padding/2+","+(this.height-this.padding-(this.height-2*this.padding)/2)+")").call(t),a.append("g").attr("id","y").attr("class","axis").attr("transform","translate("+(this.padding+(this.width-2*this.padding)/2)+",0)").call(e),a.append("g").attr("id","pathContainer"),a.append("text").attr("id","coordText").attr("transform","translate("+(this.width-3*this.padding-20)+","+(this.height-this.padding+20)+")").text("x:0 y:0")},t.prototype.dragMove=function(t,e){var a=d3.mouse(t),n=a[0],i=a[1],r=d3.select(t).attr("pathIndex");n>e.padding+e.radius&&n<e.width-2*e.padding+e.radius&&i<e.height-e.padding&&i>e.padding&&(d3.select(t).attr("class").indexOf("circle")>=0?(d3.select(t).attr("cx",n),d3.select(t).attr("cy",i),d3.select(t.parentNode.childNodes[1]).attr("transform","translate("+(n-5)+","+(i+5)+")")):(d3.select(t.parentNode.childNodes[0]).attr("cx",n),d3.select(t.parentNode.childNodes[0]).attr("cy",i),d3.select(t).attr("transform","translate("+(n-5)+","+(i+5)+")")),e.dots.UpdateDots(t,n,i,r))},t.prototype.mousedown=function(t,e){if(2==d3.event.button){if(d3.event.target.className.baseVal.indexOf("circle")>=0||d3.event.target.className.baseVal.indexOf("textT")>=0){var a=Number($(t).attr("index"));if(!isNaN(a)){$(e.dots.nodeArray[a][0]).parent().remove(),e.dots.nodeArray.splice(a,1);for(var n=a;n<e.dots.nodeArray.length;n++){var i=$(e.dots.nodeArray[n][0]).parent()[0];$(i.firstChild).attr("index",n),$(i.lastChild).text(n+1)}e.dots.nodeCount-=1}}}else if(-1===d3.event.target.className.baseVal.indexOf("circle")&&-1===d3.event.target.className.baseVal.indexOf("textT")&&-1===d3.event.target.className.baseVal.indexOf("dotPath")){var r=[0,0];r=d3.mouse(t);var s=r[0],o=r[1],d=e.drawCircle(e,s,o,e.dots.nodeCount,e.dots.pathIndex);e.dots.nodeCount++,e.dots.nodeArray.push(d)}},t.prototype.mousemove=function(t,e){var a=[0,0];a=d3.mouse(t);var n=Math.round(e.helpers.alexValToPixX(a[0])),i=Math.round(e.helpers.alexValToPixY(a[1]));d3.select("#coordText").text("x:"+n+" y:"+i)},t.prototype.insertRandom=function(){for(var t=this,e=0;30>e;e++){var a=this.helpers.alexPixToValX(Math.floor(2e3*Math.random())-1e3),n=this.helpers.alexPixToValY(Math.floor(2e3*Math.random())-1e3),i=this.drawCircle(t,a,n,t.dots.nodeCount,t.dots.pathIndex);t.dots.nodeCount++,t.dots.nodeArray.push(i)}},t.prototype.drawCircle=function(t,e,a,n,i){var r=t.svg.append("g"),s=r.append("circle").attr("index",n).attr("class","circle").attr("fill","#B5E9EA").attr("r",t.radius).attr("cx",e).attr("cy",a).attr("pathIndex",i).on("mousedown",function(){t.mousedown(this,t)}).call(t.drag);r.append("text").attr("class","textT").text(n+1).attr("transform","translate("+(e-5)+","+(a+5)+")").attr("id",n).attr("pathIndex",i).attr("fill","#00414A").call(t.drag);return s},t.prototype.Save=function(){var t={dots:this.dots.allLines};$.ajax({method:"POST",url:"/api/dots",data:JSON.stringify(t),contentType:"application/json"}).done(function(t){}).fail(function(t){console.log(t),console.log("failed")})},t.prototype.Load=function(){var t=this;$.ajax({method:"GET",url:"/api/dots"}).done(function(e){t.dots.Reset();for(var a=JSON.parse(e).dots,n=0;n<a.length;n++){for(var i=a[n],r=0;r<i.length;r++){var s=t.drawCircle(t,i[r].x,i[r].y,r,n);t.dots.nodeArray.push(s)}t.dots.JoinTheDots()}})},t}();t.Graph=e;var a=function(){function t(){}return t.prototype.alexValToPixY=function(t){return-1*(t/.27-30/.27-1e3)},t.prototype.alexPixToValY=function(t){return-1*(.27*(t+1e3)+30-600)},t.prototype.alexValToPixX=function(t){return t/.455-45/.455-1e3},t.prototype.alexPixToValX=function(t){return.455*(t+1e3)+45},t}();t.Helpers=a;var n=function(){function t(){this.lineData=[],this.nodeArray=[],this.pathIndex=0,this.allLines=[],this.nodeCount=0,this.helpers=new a,this.lineFunction=d3.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear")}return t.prototype.JoinTheDots=function(){for(var t=0;t<this.nodeArray.length;t++)this.lineData.push({x:this.nodeArray[t].attr("cx"),y:this.nodeArray[t].attr("cy")});this.lineData.push({x:this.nodeArray[0].attr("cx"),y:this.nodeArray[0].attr("cy")});var e=d3.select("#pathContainer");e.append("path").attr("class","dotPath").attr("id",this.pathIndex).attr("d",this.lineFunction(this.lineData)).attr("stroke-width",2).attr("fill","#B5E9EA").attr("opacity","0.5").attr("pathIndex",this.pathIndex),this.allLines[this.pathIndex]=this.lineData,this.lineData=[],this.nodeArray=[],d3.selectAll(".textT").remove(),d3.selectAll(".circle").attr("r",7).classed("joined_circle",!0).classed("circle",!1),this.nodeCount=0,$("#areaText").append('<a class="btn btn-default"></a>'),$("#areaText a:last-child").addClass("areaTag").attr("pathIndex",this.pathIndex).click(function(){var t=this;d3.selectAll(".joined_circle").classed("selectedArea",!1),$(".areaTag").removeClass("selectedArea"),d3.selectAll(".dotPath").classed("selectedArea",!1),$(".dotPath").each(function(e){$(this).attr("id")===$(t).attr("pathIndex")&&(d3.select(this).classed("selectedArea",!0),$(t).addClass("selectedArea"))}),$(".joined_circle").each(function(){d3.select(this).attr("pathIndex")===$(t).attr("pathIndex")&&d3.select(this).classed("selectedArea",!0)})}).text("Area: "+(this.pathIndex+1)),this.pathIndex++},t.prototype.Reset=function(){d3.selectAll("circle").remove(),d3.selectAll(".textT").remove(),d3.selectAll(".dotPath").remove(),d3.select("#areaText").selectAll("*").remove(),this.nodeCount=0,this.nodeArray=[],this.lineData=[],this.pathIndex=0},t.prototype.UpdateDots=function(t,e,a,n){var i=this,r=this.allLines[n];if(void 0!=r){0==Number($(t).attr("index"))&&(r[r.length-1]={x:e,y:a}),r[Number($(t).attr("index"))]={x:e,y:a};d3.selectAll(".dotPath").each(function(t){var e=d3.select(this).attr("id");return e===n?(d3.select(this).attr("d",i.lineFunction(r)),!1):void 0})}},t}();t.Dots=n,$(document).ready(function(){var t=new e("#d3QuestionArea");$("#JoinButton").on("click",function(){t.dots.JoinTheDots()}),$("#ResetButton").on("click",function(){t.dots.Reset()}),$("#SaveButton").on("click",function(){t.Save()}),$("#LoadButton").on("click",function(){t.Load()}),$("#RandomButton").on("click",function(){t.insertRandom()})})}(JoinTheDots||(JoinTheDots={}));